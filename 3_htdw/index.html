<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>3a: How to Design Worlds | How to Code</title>
    <meta name="description" content="">
    <link rel="icon" href="/mooc_htdp/favicon.ico">
    
    <link rel="preload" href="/mooc_htdp/assets/css/0.styles.18489455.css" as="style"><link rel="preload" href="/mooc_htdp/assets/js/app.592f2e84.js" as="script"><link rel="preload" href="/mooc_htdp/assets/js/6.1399ec09.js" as="script"><link rel="prefetch" href="/mooc_htdp/assets/js/2.c3a79ebd.js"><link rel="prefetch" href="/mooc_htdp/assets/js/3.995fccf7.js"><link rel="prefetch" href="/mooc_htdp/assets/js/4.30812adf.js"><link rel="prefetch" href="/mooc_htdp/assets/js/5.04b7ebe3.js"><link rel="prefetch" href="/mooc_htdp/assets/js/7.bde6f355.js"><link rel="prefetch" href="/mooc_htdp/assets/js/8.73ede66b.js"><link rel="prefetch" href="/mooc_htdp/assets/js/9.35d4c287.js">
    <link rel="stylesheet" href="/mooc_htdp/assets/css/0.styles.18489455.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mooc_htdp/" class="home-link router-link-active"><!----> <span class="site-name">How to Code</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/mooc_htdp/" class="sidebar-link">How to Code</a></li><li><a href="/mooc_htdp/00_introduction.html" class="sidebar-link">Welcome</a></li><li><a href="/mooc_htdp/1a_bsl/" class="sidebar-link">1a: Beginning Student Language</a></li><li><a href="/mooc_htdp/1b_htdf/" class="sidebar-link">1b: How to Design Functions</a></li><li><a href="/mooc_htdp/2_htdd/" class="sidebar-link">2: How to Design Data</a></li><li><a href="/mooc_htdp/3_htdw/" class="active sidebar-link">3a: How to Design Worlds</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mooc_htdp/3_htdw/#module-overview" class="sidebar-link">Module Overview</a></li><li class="sidebar-sub-header"><a href="/mooc_htdp/3_htdw/#interactive-programs" class="sidebar-link">Interactive Programs</a></li><li class="sidebar-sub-header"><a href="/mooc_htdp/3_htdw/#the-big-bang-mechanism-all-parts" class="sidebar-link">The big-bang Mechanism (all parts)</a></li><li class="sidebar-sub-header"><a href="/mooc_htdp/3_htdw/#domain-analysis" class="sidebar-link">Domain Analysis</a></li><li class="sidebar-sub-header"><a href="/mooc_htdp/3_htdw/#program-through-main-function" class="sidebar-link">Program through main Function</a></li><li class="sidebar-sub-header"><a href="/mooc_htdp/3_htdw/#working-through-the-wish-list" class="sidebar-link">Working through the Wish List</a></li><li class="sidebar-sub-header"><a href="/mooc_htdp/3_htdw/#improving-a-world-program-add-speed" class="sidebar-link">Improving a World Program - Add SPEED</a></li><li class="sidebar-sub-header"><a href="/mooc_htdp/3_htdw/#improving-a-world-program-add-key-handler" class="sidebar-link">Improving a World Program - Add key handler</a></li><li class="sidebar-sub-header"><a href="/mooc_htdp/3_htdw/#программа-цеnиком" class="sidebar-link">Программа целиком</a></li></ul></li></ul> </div> <div class="page"> <div class="content"><h1 id="_3a-how-to-design-worlds"><a href="#_3a-how-to-design-worlds" aria-hidden="true" class="header-anchor">#</a> 3a: How to Design Worlds</h1> <h2 id="module-overview"><a href="#module-overview" aria-hidden="true" class="header-anchor">#</a> Module Overview</h2> <p>В этом модуле будет рассмотрен рецепт HtDW для создания интерактивных программ в DrRacket. Будут использованы более сложные определения данных и встроенный функционал для создания интерактивных приложений с графикой.</p> <h2 id="interactive-programs"><a href="#interactive-programs" aria-hidden="true" class="header-anchor">#</a> Interactive Programs</h2> <p>Будем делать небольшие интерактивные графические приложения и однострочный текстовый редактор, похожий на поле для отправки СМС в телефоне.</p> <h2 id="the-big-bang-mechanism-all-parts"><a href="#the-big-bang-mechanism-all-parts" aria-hidden="true" class="header-anchor">#</a> The big-bang Mechanism (all parts)</h2> <p>MTS (eMpTy Scene) — холст, на котором размещаются графические интерактивные объекты (белый прямоугольник, по которому двигается кот).</p> <p>CTR-Y — CenTeR Y — координата по оси ординат.</p> <p><a href="https://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._place-image%29%29" target="_blank" rel="noopener noreferrer"><code>place-image</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> размещает одну картинку внутри другой (MTS).</p> <p>Чтобы показать перемещающегося слева-направо кота, нужно постепенно увеличивать его координату <code>X</code>, смещать картинку, снова увеличивать координату <code>X</code>, снова смещать картину и так далее:</p> <img src="/mooc_htdp/assets/img/moving_cat.4eb51422.png" width="400"> <p>Для таких действий в Racket есть конструкция <a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html?q=big-bang#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._big-bang%29%29" target="_blank" rel="noopener noreferrer"><code>big-bang</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> — выражение, с помощью которого можно рендерить интерактивные штуки.</p> <div class="language-scheme extra-class"><pre class="language-scheme"><code><span class="token punctuation">(</span><span class="token function">big-bang</span> <span class="token number">0</span>               <span class="token comment">; начальное состояние, первая позиция кота</span>
    <span class="token punctuation">(</span><span class="token function">on-tick</span> next-cat<span class="token punctuation">)</span>    <span class="token comment">; ф-я возвращает следующую координату X</span>
    <span class="token punctuation">(</span><span class="token function">to-draw</span> render-cat<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">; ф-я рисует кота с заданными координатами</span>
</code></pre></div><p>То есть функция <code>big-bang</code>, как и сам Большой взрыв, отвечает за создание мира и меняет его состояние.</p> <p><code>big-bang</code> — UI Framework — полиморфная функция, которая может принимать разные аргументы: списки, числа и пр. типы пользователя. Главное, чтобы аргументы были одного типа:</p> <div class="language-scheme extra-class"><pre class="language-scheme"><code><span class="token punctuation">(</span><span class="token function">big-bang</span> <span class="token number">0</span>               <span class="token comment">; X</span>
    <span class="token punctuation">(</span><span class="token function">on-tick</span> next-cat<span class="token punctuation">)</span>    <span class="token comment">; X-&gt;X</span>
    <span class="token punctuation">(</span><span class="token function">to-draw</span> render-cat<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">; X-&gt;Image</span>
</code></pre></div><h2 id="domain-analysis"><a href="#domain-analysis" aria-hidden="true" class="header-anchor">#</a> Domain Analysis</h2> <p>Domain Analysis — анализ предметной области:</p> <blockquote><p>The first phase of the How to Design Worlds (HtDW) recipe is to analyze the problem to identify <em>constant</em> information, <em>changing</em> information and required <code>big-bang</code> <em>options</em>.</p></blockquote> <p>Сперва нужно провести анализ (на бумажке), чтобы понять, из чего будет состоять наш мир. И уже потом реализовывать программу. Две фазы, они обозначены в <a href="https://courses.edx.org/courses/course-v1:UBCx+HtC1x+2T2017/77860a93562d40bda45e452ea064998b/#HtDW" target="_blank" rel="noopener noreferrer">рецепте HtDW<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>Domain analysis — первая фаза (use a piece of paper!):</p> <ol><li>Sketch program scenarios.</li> <li>Identify constant information.</li> <li>Identify changing information.</li> <li>Identify big-bang options.</li></ol> <img src="/mooc_htdp/assets/img/domain_analysis.0c9c9f4b.png"> <h2 id="program-through-main-function"><a href="#program-through-main-function" aria-hidden="true" class="header-anchor">#</a> Program through main Function</h2> <p>После анализа предметной области мы получили пачку констант, переменных и методов, которые нужно будет применить для создания и функционирования мира. После этого можно приступать к коду — второму шагу в <a href="https://courses.edx.org/courses/course-v1:UBCx+HtC1x+2T2017/77860a93562d40bda45e452ea064998b/#HtDW" target="_blank" rel="noopener noreferrer">рецепте HtDW<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>Build the actual program:</p> <ol><li>Constants (based on 1.2 above)</li> <li>Data definitions using HtDD (based on 1.3 above)</li> <li>Functions using HtDF:
<ol><li>main first (based on 1.3, 1.4 and 2.2 above)</li> <li>wish list entries for <code>big-bang</code> handlers</li></ol></li> <li>Work through wish list until done</li></ol> <blockquote><p>Traceability: the ability to see where each element winds up in the resulting program.</p></blockquote> <p>Traceability — отслеживаемость. Как данные из анализа на первом шаге представлены в коде на шаге 2.</p> <p>Почему важно создавать константы и не использовать значения явно (<code>HEIGHT / 2</code> вместо <code>200</code>):</p> <blockquote><p>There's program that the change and programs that nobody uses.</p></blockquote> <p>Программа будет меняться. Когда есть константы и переменные, то менять программу проще.</p> <p>В <a href="https://courses.edx.org/courses/course-v1:UBCx+HtC1x+2T2017/77860a93562d40bda45e452ea064998b/#HtDW" target="_blank" rel="noopener noreferrer">рецепте<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> есть шаблон программы. В разделе с определением данных <code>WS</code> — это World State (состояние мира).</p> <h2 id="working-through-the-wish-list"><a href="#working-through-the-wish-list" aria-hidden="true" class="header-anchor">#</a> Working through the Wish List</h2> <p>Меткой <code>!!!</code> в шаблоне отмечены места, к которым нужно вернуться позже и заполнить.</p> <p>По рецепту, пункт 2.4 (Work through wish list until done) говорит, что нужно просто пройтись по всем <code>!!!</code> и заменить их тем, что нужно, используя HtDF-рецепт.</p> <p>Шаблон и рецепты позволяют в каждый момент времени делать одну задачу, получая в итоге целую программу.</p> <blockquote><p>The big benefit of having a systematic process is it lets you work on one thing at a time and know that it's all going to work out.</p></blockquote> <p>Некоторые части процесса не заметны в итоговой программе: анализ предметной области, шаблон программы. Тем не менее, это важные шаги, которые подводят нас к результату:</p> <blockquote><p>People who design <em>design methods</em>, so that's a kind of meta-design, that's one of the things they work on is, how can there be elements of the design that get you there even though they disappear in the final artifact?</p></blockquote> <h2 id="improving-a-world-program-add-speed"><a href="#improving-a-world-program-add-speed" aria-hidden="true" class="header-anchor">#</a> Improving a World Program - Add SPEED</h2> <p>Задача: нужно иметь возможность задавать скорость.</p> <p>Анализ предметной области — это модель программы, которая в общих чертах описывает её структуру. Анализ предметной области — план реализации программы.</p> <p>Программы постоянно меняются. Хорошие программы позволяют менять/дополнять код без особых затруднений. Этому способствует грамотный анализ (подготовка модели) и четкое соответствие модели и её представления в виде кода.</p> <p>Добавлять новую фичу (например, скорость перемещения кота) нужно также с анализа. К уже существующим константам добавляется новая — <code>SPEED</code>. И нужно также изменить функцию, которая перемещает кота слева-направо.</p> <h2 id="improving-a-world-program-add-key-handler"><a href="#improving-a-world-program-add-key-handler" aria-hidden="true" class="header-anchor">#</a> Improving a World Program - Add key handler</h2> <p>Задача: при клике на пробел кот должен возвращаться к левому краю (в начало отсчета).</p> <p>Снова возвращаемся к анализу. Констант добавлять не надо, модифицировать существующие функции тоже. Появляется новый параметр в функции <code>big-bang</code> — <code>on-key</code>:</p> <div class="language-scheme extra-class"><pre class="language-scheme"><code><span class="token punctuation">(</span><span class="token function">big-bang</span> ws<span class="token punctuation">)</span>
    <span class="token comment">; ...</span>
    <span class="token punctuation">(</span><span class="token function">on-key</span>    ...<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">; Cat KeyEvent -&gt; Cat</span>
</code></pre></div><p><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28tech._world._keyevent%29" target="_blank" rel="noopener noreferrer"><code>KeyEvent</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> в Racket — large enumeration. Может принимать значения для всех кнопок на клавиатуре.</p> <p>Тип <code>KeyEvent</code> может принимать очень много значений, для всех тесты писать нет смысла, как это делается по рецепту для обычных <a href="/mooc_htdp/2_htdd/#enumeration">Enumerations</a>. Шаблон для этого типа такой (он есть <a href="https://courses.edx.org/courses/course-v1:UBCx+HtC1x+2T2017/77860a93562d40bda45e452ea064998b/#HtDW" target="_blank" rel="noopener noreferrer">в рецептах<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>):</p> <div class="language-scheme extra-class"><pre class="language-scheme"><code><span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">handle-key</span> ws ke<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">cond</span> [<span class="token punctuation">(</span><span class="token function">key=?</span> ke <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token function">...</span> ws<span class="token punctuation">)</span>]
        [else 
         <span class="token punctuation">(</span><span class="token function">...</span> ws<span class="token punctuation">)</span>]<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>Здесь мы обрабатываем только нужные кейсы и запихиваем остальное в <code>else</code>.</p> <p>Для таких случаев можно писать white-box тесты: проверяем только те кейсы, которые непосредственно используем в программе (нажатие пробела). Для остальных кнопок достаточно одного примера на случай (когда <code>c</code> равно <code>0</code> или когда <code>c</code> равно <code>10</code> в нашем случае).</p> <div class="language-scheme extra-class"><pre class="language-scheme"><code><span class="token comment">;; Cat KeyEvent -&gt; Cat</span>
<span class="token comment">;; reset cat to left edge when space key is pressed</span>
<span class="token punctuation">(</span><span class="token function">check-expect</span> <span class="token punctuation">(</span><span class="token function">handle-key</span> <span class="token number">10</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">check-expect</span> <span class="token punctuation">(</span><span class="token function">handle-key</span> <span class="token number">10</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">check-expect</span> <span class="token punctuation">(</span><span class="token function">handle-key</span>  <span class="token number">0</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">check-expect</span> <span class="token punctuation">(</span><span class="token function">handle-key</span>  <span class="token number">0</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment">;(define (handle-key c ke) 0) ; stub</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">handle-key</span> c ke<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">cond</span> [<span class="token punctuation">(</span><span class="token function">key=?</span> ke <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span> <span class="token number">0</span>]
        [else c]<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="программа-цеnиком"><a href="#программа-цеnиком" aria-hidden="true" class="header-anchor">#</a> Программа целиком</h2> <div class="language-scheme extra-class"><pre class="language-scheme"><code><span class="token comment">; PROBLEM:</span>
<span class="token comment">; </span>
<span class="token comment">; Use the How to Design Worlds recipe to design an interactive</span>
<span class="token comment">; program in which a cat starts at the left edge of the display </span>
<span class="token comment">; and then walks across the screen to the right. When the cat</span>
<span class="token comment">; reaches the right edge it should just keep going right off </span>
<span class="token comment">; the screen.</span>
<span class="token comment">; </span>
<span class="token comment">; Once your design is complete revise it to add a new feature,</span>
<span class="token comment">; which is that pressing the space key should cause the cat to</span>
<span class="token comment">; go back to the left edge of the screen. When you do this, go</span>
<span class="token comment">; all the way back to your domain analysis and incorporate the</span>
<span class="token comment">; new feature.</span>
<span class="token comment">; </span>
<span class="token comment">; To help you get started, here is a picture of a cat, which we</span>
<span class="token comment">; have taken from the 2nd edition of the How to Design Programs </span>
<span class="token comment">; book on which this course is based.</span>
<span class="token comment">; </span>
<span class="token comment">; !!! Replace emoji 🐱 with graphics in DrRacket !!!</span>
<span class="token comment">; </span>

<span class="token punctuation">(</span><span class="token function">require</span> 2htdp/image<span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">require</span> 2htdp/universe<span class="token punctuation">)</span>

<span class="token comment">;; A cat that walks from left to right across the screen</span>


<span class="token comment">;; =================</span>
<span class="token comment">;; Constants:</span>
<span class="token punctuation">(</span><span class="token keyword">define</span> WIDTH <span class="token number">600</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token keyword">define</span> HEIGHT <span class="token number">400</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token keyword">define</span> CTR-Y <span class="token punctuation">(</span><span class="token operator">/</span> HEIGHT <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token keyword">define</span> MTS <span class="token punctuation">(</span><span class="token function">empty-scene</span> WIDTH HEIGHT<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token keyword">define</span> SPEED <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token keyword">define</span> CAT-IMG 🐱<span class="token punctuation">)</span>


<span class="token comment">;; =================</span>
<span class="token comment">;; Data definitions:</span>

<span class="token comment">;; Cat is Number</span>
<span class="token comment">;; Interp. x position of the cat in screen coordinates</span>
<span class="token punctuation">(</span><span class="token keyword">define</span> C1 <span class="token number">0</span><span class="token punctuation">)</span>           <span class="token comment">; left edge</span>
<span class="token punctuation">(</span><span class="token keyword">define</span> C2 <span class="token punctuation">(</span><span class="token operator">/</span> WIDTH <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">; middle</span>
<span class="token punctuation">(</span><span class="token keyword">define</span> C3 WIDTH<span class="token punctuation">)</span>       <span class="token comment">; right edge</span>
<span class="token comment">;#</span>
<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">fn-for-cat</span> c<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token function">...</span> c<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">;; Template rules used:</span>
<span class="token comment">;; - atomic non-distinct: Number</span>


<span class="token comment">;; =================</span>
<span class="token comment">;; Functions:</span>

<span class="token comment">;; Cat -&gt; Cat</span>
<span class="token comment">;; start the world with (main 0)</span>
<span class="token comment">;; </span>
<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">main</span> c<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token function">big-bang</span> c                       <span class="token comment">; Cat</span>
            <span class="token punctuation">(</span><span class="token function">on-tick</span> advance-cat<span class="token punctuation">)</span>   <span class="token comment">; Cat -&gt; Cat</span>
            <span class="token punctuation">(</span><span class="token function">on-key</span> handle-key<span class="token punctuation">)</span>     <span class="token comment">; Cat KeyEvent -&gt; Cat</span>
            <span class="token punctuation">(</span><span class="token function">on-mouse</span> handle-mouse<span class="token punctuation">)</span> <span class="token comment">; Cat Integer Integer MouseEvent -&gt; Cat</span>
            <span class="token punctuation">(</span><span class="token function">to-draw</span> render<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token comment">; Cat -&gt; Image</span>


<span class="token comment">;; Cat -&gt; Cat</span>
<span class="token comment">;; produce the next cat by advancing it SPEED pixels to right</span>
<span class="token punctuation">(</span><span class="token function">check-expect</span> <span class="token punctuation">(</span><span class="token function">advance-cat</span> <span class="token number">0</span><span class="token punctuation">)</span> SPEED<span class="token punctuation">)</span>
<span class="token comment">;(define (advance-cat c) 0) ;stub</span>
<span class="token comment">; &lt;use template from Cat&gt;</span>
<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">advance-cat</span> c<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token operator">+</span> c SPEED<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token comment">;; Cat -&gt; Image</span>
<span class="token comment">;; render the cat image at appropriate place on MTS</span>
<span class="token punctuation">(</span><span class="token function">check-expect</span> <span class="token punctuation">(</span><span class="token function">render</span> <span class="token number">0</span><span class="token punctuation">)</span>
              <span class="token punctuation">(</span><span class="token function">place-image</span> CAT-IMG <span class="token number">0</span> CTR-Y MTS<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">;(define (render c) MTS) ; sub</span>
<span class="token comment">; &lt;use template from Cat&gt;</span>
<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">render</span> c<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token function">place-image</span> CAT-IMG c CTR-Y MTS<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token comment">;; Cat KeyEvent -&gt; Cat</span>
<span class="token comment">;; reset cat to left edge when space key is pressed</span>
<span class="token punctuation">(</span><span class="token function">check-expect</span> <span class="token punctuation">(</span><span class="token function">handle-key</span> <span class="token number">10</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">check-expect</span> <span class="token punctuation">(</span><span class="token function">handle-key</span> <span class="token number">10</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">check-expect</span> <span class="token punctuation">(</span><span class="token function">handle-key</span>  <span class="token number">0</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">check-expect</span> <span class="token punctuation">(</span><span class="token function">handle-key</span>  <span class="token number">0</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment">;(define (handle-key c ke) 0) ; stub</span>
<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">handle-key</span> c ke<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">cond</span> [<span class="token punctuation">(</span><span class="token function">key=?</span> ke <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span> <span class="token number">0</span>]
        [else c]<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token comment">;; Cat Integer Integer MouseEvent -&gt; Cat</span>
<span class="token comment">;; set cat left position to the current exposition of the mouse</span>
<span class="token punctuation">(</span><span class="token function">check-expect</span> <span class="token punctuation">(</span><span class="token function">handle-mouse</span> <span class="token number">10</span> <span class="token number">50</span> CTR-Y <span class="token string">&quot;button-down&quot;</span><span class="token punctuation">)</span> <span class="token number">50</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">check-expect</span> <span class="token punctuation">(</span><span class="token function">handle-mouse</span> <span class="token number">10</span> <span class="token number">50</span> CTR-Y <span class="token string">&quot;move&quot;</span><span class="token punctuation">)</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token comment">;(define (handle-mouse c x y me) 0) ; stub</span>
<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">handle-mouse</span> c x y me<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">cond</span> [<span class="token punctuation">(</span><span class="token function">mouse=?</span> me <span class="token string">&quot;button-down&quot;</span><span class="token punctuation">)</span> x]
        [else c]<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/mooc_htdp/2_htdd/" class="prev">
          2: How to Design Data
        </a></span> <!----></p></div> </div> <!----></div></div>
    <script src="/mooc_htdp/assets/js/app.592f2e84.js" defer></script><script src="/mooc_htdp/assets/js/6.1399ec09.js" defer></script>
  </body>
</html>

<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>1b: How to Design Functions | How to Code</title>
    <meta name="description" content="">
    <link rel="icon" href="/mooc_htdp/favicon.ico">
    
    <link rel="preload" href="/mooc_htdp/assets/css/0.styles.18489455.css" as="style"><link rel="preload" href="/mooc_htdp/assets/js/app.592f2e84.js" as="script"><link rel="preload" href="/mooc_htdp/assets/js/5.04b7ebe3.js" as="script"><link rel="prefetch" href="/mooc_htdp/assets/js/2.c3a79ebd.js"><link rel="prefetch" href="/mooc_htdp/assets/js/3.995fccf7.js"><link rel="prefetch" href="/mooc_htdp/assets/js/4.30812adf.js"><link rel="prefetch" href="/mooc_htdp/assets/js/6.1399ec09.js"><link rel="prefetch" href="/mooc_htdp/assets/js/7.bde6f355.js"><link rel="prefetch" href="/mooc_htdp/assets/js/8.73ede66b.js"><link rel="prefetch" href="/mooc_htdp/assets/js/9.35d4c287.js">
    <link rel="stylesheet" href="/mooc_htdp/assets/css/0.styles.18489455.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mooc_htdp/" class="home-link router-link-active"><!----> <span class="site-name">How to Code</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/mooc_htdp/" class="sidebar-link">How to Code</a></li><li><a href="/mooc_htdp/00_introduction.html" class="sidebar-link">Welcome</a></li><li><a href="/mooc_htdp/1a_bsl/" class="sidebar-link">1a: Beginning Student Language</a></li><li><a href="/mooc_htdp/1b_htdf/" class="active sidebar-link">1b: How to Design Functions</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mooc_htdp/1b_htdf/#module-overview" class="sidebar-link">Module Overview</a></li><li class="sidebar-sub-header"><a href="/mooc_htdp/1b_htdf/#htdf-recipe" class="sidebar-link">HtDF Recipe</a></li><li class="sidebar-sub-header"><a href="/mooc_htdp/1b_htdf/#пример-функции-со-строками" class="sidebar-link">Пример функции со строками</a></li><li class="sidebar-sub-header"><a href="/mooc_htdp/1b_htdf/#отnадка" class="sidebar-link">Отладка</a></li><li class="sidebar-sub-header"><a href="/mooc_htdp/1b_htdf/#рецепт-не-по-шагам" class="sidebar-link">Рецепт не по шагам</a></li><li class="sidebar-sub-header"><a href="/mooc_htdp/1b_htdf/#poorly-formed-problems" class="sidebar-link">Poorly Formed Problems</a></li><li class="sidebar-sub-header"><a href="/mooc_htdp/1b_htdf/#граничные-сnучаи" class="sidebar-link">Граничные случаи</a></li><li class="sidebar-sub-header"><a href="/mooc_htdp/1b_htdf/#проверка-заданий-на-edx" class="sidebar-link">Проверка заданий на edX</a></li></ul></li><li><a href="/mooc_htdp/2_htdd/" class="sidebar-link">2: How to Design Data</a></li><li><a href="/mooc_htdp/3_htdw/" class="sidebar-link">3a: How to Design Worlds</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="_1b-how-to-design-functions"><a href="#_1b-how-to-design-functions" aria-hidden="true" class="header-anchor">#</a> 1b: How to Design Functions</h1> <p>Что значит дизайн:</p> <blockquote><p>Design is the process of going from a poorly formed problem to a well structured solution.</p></blockquote> <h2 id="module-overview"><a href="#module-overview" aria-hidden="true" class="header-anchor">#</a> Module Overview</h2> <p>Цель модуля:</p> <ul><li>Научиться применять рецепт для создания функций, оперирующих простыми данными;</li> <li>Научиться читать функции и разбирать разные элементы их дизайна;</li> <li>Научиться проверять разные элементы функции на доступность, простоту, ясность и консистентность;</li> <li>Научиться определять, на сколько рецепт, по которому написана функция, решает задачу.</li></ul> <p>In English:</p> <ul><li>Be able to use the How to Design Functions (HtDF) recipe to design functions that operate on primitive data.</li> <li>Be able to read a complete function design and identify its different elements.</li> <li>Be able to evaluate the different elements for clarity, simplicity and consistency with each other.</li> <li>Be able to evaluate the entire design for how well it solves the given problem.</li></ul> <h2 id="htdf-recipe"><a href="#htdf-recipe" aria-hidden="true" class="header-anchor">#</a> HtDF Recipe</h2> <p>Рецепт помогает составить правильное представление о функции, которую нужно записать в виде кода. Его не нужно запоминать, но нужно научиться им пользоваться как руководством при проектировании функций. И выработать привычку к написанию продуманного кода.</p> <p>Рецепт нужен для того, чтобы раздробить большую задачу на несколько мелких и дать четкие пошаговые рекомендации. Это очень хорошо для начинающих.</p> <p>Совсем простые функции с использованием рецепта выглядят натянутыми, зато сложные функции с использованием рецепта написать проще и результат будет качественнее.</p> <p>Рецепт состоит из следующих шагов:</p> <ol><li>Сигнатура, назначение, заглушка (Signature, purpose and stub).</li> <li>Примеры-тесты (define examples, wrap each in <code>(check-expect ...)</code>).</li> <li>Шаблон (Template and inventory).</li> <li>Тело функции (Code the function body).</li> <li>Тестирование и исправление (Test and debug until correct).</li></ol> <div class="tip custom-block"><p class="custom-block-title">Объяснялочка</p> <p>Термины «аргумент», «параметр» и «входящее значение» в тексте ниже можно считать эквивалентными.</p> <p>Если посмотреть на вопрос по-задротски, то параметры функции — это переменные, используемые в объявлении функции. Аргументы — это реальные значения, которые передаются в функцию при её вызове:</p> <div class="language-scheme extra-class"><pre class="language-scheme"><code><span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">double</span> n<span class="token punctuation">)</span> <span class="token comment">; n - параметр</span>
    <span class="token punctuation">(</span><span class="token operator">*</span> n <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">double</span> <span class="token number">4</span><span class="token punctuation">)</span>         <span class="token comment">; 4 - аргумент</span>
</code></pre></div></div> <h3 id="_1-сигнатура-назначение-загnушка"><a href="#_1-сигнатура-назначение-загnушка" aria-hidden="true" class="header-anchor">#</a> 1. Сигнатура, назначение, заглушка</h3> <p>Для примера рассмотрим такую задачу:</p> <blockquote><p>Design a function that consumes a number and produces twice that number. Call your function double. Follow the HTdF recipe and show the stub and template.</p></blockquote> <p>То есть нужно написать простую функцию, которая принимает значение и возвращает его умноженным на 2.</p> <h4 id="сигнатура"><a href="#сигнатура" aria-hidden="true" class="header-anchor">#</a> Сигнатура</h4> <p>Здесь сигнатура функции — это тип данных, которые функция принимает и тип данных возвращаемого значения. Типы данных указываются с большой буквы, возвращаемый тип указывается после стрелки.</p> <p>У функции из примера сигнатура будет такая:</p> <div class="language-scheme extra-class"><pre class="language-scheme"><code><span class="token comment">;; Number -&gt; Number</span>
</code></pre></div><p>Если аргументов несколько, то указываются все их типы через запятую до стрелки:</p> <div class="language-scheme extra-class"><pre class="language-scheme"><code><span class="token comment">;; Number, Number, Bool -&gt; Number</span>
</code></pre></div><p>Это первая строка.</p> <h4 id="назначение"><a href="#назначение" aria-hidden="true" class="header-anchor">#</a> Назначение</h4> <p>Назначение (purpose, цель, описание) — краткое, <em>однострочное</em> описание того, что функция возвращает с учетом того, что она принимает. Назначение расширяет сигнатуру, добавляет в нее смысл. Сигнатура говорит о типе значений, а назначение говорит, что мы должны получить из входных параметров.</p> <p>Например, наша функция возвращает аргумент, умноженный на два:</p> <div class="language-scheme extra-class"><pre class="language-scheme"><code><span class="token comment">;; produce 2 times the given number</span>
</code></pre></div><p>Назначение «принимает число и возвращает число» — плохое, оно дублирует сигнатуру. Нужно конкретно указывать, что именно будет возвращено и что за параметры приходят. Например, если нужно посчитать площадь квадрата по его стороне, то можно написать такое назначение:</p> <div class="language-scheme extra-class"><pre class="language-scheme"><code><span class="token comment">;; Number -&gt; Number</span>
<span class="token comment">;; Принимает длину стороны квадрата, возвращает его площадь.</span>
</code></pre></div><p>То есть назначение <em>придает смысл типам, обозначенным в сигнатуре</em>.</p> <p>Важно записать назначение в одну строку. Иногда это бывает сложно, но усилия на формулировку однострочного назначения позволят лучше понять, что должна выполнять функция.</p> <p>Сигнатура и назначение всегда остаются в комментарии перед функцией:</p> <div class="language-scheme extra-class"><pre class="language-scheme"><code><span class="token comment">;; Number -&gt; Number</span>
<span class="token comment">;; produce 2 times the given number</span>
</code></pre></div><h4 id="загnушка"><a href="#загnушка" aria-hidden="true" class="header-anchor">#</a> Заглушка</h4> <p>Заглушка (stub) — это временный код, псевдореализация с фейковым возвращаемым значением. Заглушка позволяет убедится, что тесты, которые мы добавим на следующем шаге, запускаются.</p> <p>Заглушка должна иметь правильное имя функции, принимать нужное число параметров, возвращать заглушечный результат нужного типа (например, <code>0</code> для чисел, <code>true</code> для булевых значений и т.д.):</p> <div class="language-scheme extra-class"><pre class="language-scheme"><code><span class="token comment">;; Number -&gt; Number                      ; сигнатура</span>
<span class="token comment">;; produce 2 times the given number      ; назначение</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">double</span> n<span class="token punctuation">)</span>  <span class="token number">0</span><span class="token punctuation">)</span>                   <span class="token comment">; заглушка</span>
</code></pre></div><h3 id="_2-примеры-тесты"><a href="#_2-примеры-тесты" aria-hidden="true" class="header-anchor">#</a> 2. Примеры-тесты</h3> <p>Примеры-тесты — это вызовы нашей функции с реальными значениями, результат которых проверяется функцией <a href="https://docs.racket-lang.org/htdp-langs/beginner.html#%28form._%28%28lib._lang%2Fhtdp-beginner..rkt%29._check-expect%29%29" target="_blank" rel="noopener noreferrer"><code>(check-expect ...)</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Таким образом примеры и тесты в Racket работают вместе.</p> <p>Примеры-тесты вставляются перед заглушкой:</p> <div class="language-scheme extra-class"><pre class="language-scheme"><code><span class="token comment">;; Number -&gt; Number                      ; сигнатура</span>
<span class="token comment">;; produce 2 times the given number      ; назначение</span>
<span class="token punctuation">(</span><span class="token function">check-expect</span> <span class="token punctuation">(</span><span class="token function">double</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">4</span><span class="token punctuation">)</span>              <span class="token comment">; пример-тест</span>
<span class="token punctuation">(</span><span class="token function">check-expect</span> <span class="token punctuation">(</span><span class="token function">double</span> <span class="token number">4.2</span><span class="token punctuation">)</span> <span class="token number">8.4</span><span class="token punctuation">)</span>          <span class="token comment">; пример-тест</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">double</span> n<span class="token punctuation">)</span>  <span class="token number">0</span><span class="token punctuation">)</span>                   <span class="token comment">; заглушка</span>
</code></pre></div><p>Запускаем — тесты провалятся т.к. сейчас наша функция всегда возвращает <code>0</code>. Зато мы увидим, выполнились ли все тесты. Если выполнились, значит мы их написали верно и можно идти дальше. Тут выполнились 2 теста, все ок:</p> <p><img src="/mooc_htdp/assets/img/failed_tests_with_stub.b1e328dc.png" alt></p> <p>Если не все тесты выполнились и упали, начит в каких-то из них есть ошибки, которые нужно исправить.</p> <p>Важно убедиться, что тесты написаны хорошо как можно раньше (выполняются с заглушкой и падают), перед реализацией самой функции. Потому что если в тест закралась ошибка (не выполнится при запуске с заглушкой), то при работе над более сложной функцией можно потерять много времени.</p> <p>Имея под рукой примеры и тесты, функцию проще реализовать. Становится понятнее, как она должна себя вести, какое значение должна возвращать в зависимости от аргументов, какой у нее должен быть синтаксис. Об этом можно будет не думать на этапе работы с телом функции, где задачи уже будут алгоритмические.</p> <p>В примерах-тестах нужно использовать разные аргументы. Например, если функция принимает число, то числа могут быть отрицательными, десятичными дробями, нулем и т.д.</p> <p>Если сигнатуры верные, типы ожидаемых и возвращаемых величин совпадают. Это важно, потому что в сложных функциях вероятность допустить ошибки в тестах возрастает.</p> <p>Как только тесты проверены, заглушку можно закоментить (далее по курсу она удаляется).</p> <div class="tip custom-block"><p class="custom-block-title">Объяснялочка</p> <p>Каждый записанный по рецепту шаг помогает записать следующий. Например, сигнатура помогает написать назначение и заглушку, потому что указывает типы и количество принимаемых значений и тип возвращаемого значения.</p> <p>По сигнатуре видно, что наша функция принимает число и возвращает число. Значит в назначении нужно указать, чем является это за число, а в заглушке использовать что-то, что является числом в качестве возвращаемого значения (<code>0</code> в нашем случае). И т.д.</p></div> <h3 id="_3-шабnон"><a href="#_3-шабnон" aria-hidden="true" class="header-anchor">#</a> 3. Шаблон</h3> <p>Тело шаблона — набросок функции (outline), который будет использован как основа для финальной функции:</p> <div class="language-scheme extra-class"><pre class="language-scheme"><code><span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">double</span> n<span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token function">...</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment">; функция делает &quot;что-то&quot; с `n`</span>
</code></pre></div><blockquote><p>The template is really trying to tell you: hey, here's the stuff you have to work with.</p></blockquote> <p>После 3-го шага получим:</p> <div class="language-scheme extra-class"><pre class="language-scheme"><code><span class="token comment">;; Number -&gt; Number                      ; сигнатура</span>
<span class="token comment">;; produce 2 times the given number      ; назначение</span>
<span class="token punctuation">(</span><span class="token function">check-expect</span> <span class="token punctuation">(</span><span class="token function">double</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">4</span><span class="token punctuation">)</span>              <span class="token comment">; пример-тест</span>
<span class="token punctuation">(</span><span class="token function">check-expect</span> <span class="token punctuation">(</span><span class="token function">double</span> <span class="token number">4.2</span><span class="token punctuation">)</span> <span class="token number">8.4</span><span class="token punctuation">)</span>          <span class="token comment">; пример-тест</span>

<span class="token comment">;(define (double n)  0)                  ; заглушка</span>
<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">double</span> n<span class="token punctuation">)</span>                       <span class="token comment">; шаблон</span>
    <span class="token punctuation">(</span><span class="token function">...</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_4-теnо-функции"><a href="#_4-теnо-функции" aria-hidden="true" class="header-anchor">#</a> 4. Тело функции</h3> <p>Копируем шаблон и вместо <code>...</code> пишем реализацию. Сам шаблон комментируем (далее по курсу его можно будет удалять, но для начала рекомендуется оставить перед глазами). Используем все, что узнали и записали на предыдущих шагах.</p> <p>Помогает разбор записанных примеров. Нужно разбить их на составные части, чтобы более явно увидеть, каким образом получается результат:</p> <div class="language-scheme extra-class"><pre class="language-scheme"><code><span class="token punctuation">(</span><span class="token function">check-expect</span> <span class="token punctuation">(</span><span class="token function">double</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token number">6</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">check-expect</span> <span class="token punctuation">(</span><span class="token function">double</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span> <span class="token number">3</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment">; то же самое, но явно</span>

<span class="token punctuation">(</span><span class="token function">check-expect</span> <span class="token punctuation">(</span><span class="token function">double</span> <span class="token number">4.2</span><span class="token punctuation">)</span> <span class="token number">8.4</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">check-expect</span> <span class="token punctuation">(</span><span class="token function">double</span> <span class="token number">4.2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span> <span class="token number">4.2</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">; то же самое, но явно</span>
</code></pre></div><p>Ага, понятно. Результат всегда в 2 раза больше аргументов, значит в теле функции нужно написать <code>(* n 2)</code>:</p> <div class="language-scheme extra-class"><pre class="language-scheme"><code><span class="token comment">;; Number -&gt; Number                      ; сигнатура</span>
<span class="token comment">;; produce 2 times the given number      ; назначение</span>
<span class="token punctuation">(</span><span class="token function">check-expect</span> <span class="token punctuation">(</span><span class="token function">double</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">4</span><span class="token punctuation">)</span>              <span class="token comment">; пример-тест</span>
<span class="token punctuation">(</span><span class="token function">check-expect</span> <span class="token punctuation">(</span><span class="token function">double</span> <span class="token number">4.2</span><span class="token punctuation">)</span> <span class="token number">8.4</span><span class="token punctuation">)</span>          <span class="token comment">; пример-тест</span>

<span class="token comment">;(define (double n)  0)                  ; заглушка</span>
<span class="token comment">;(define (double n)                      ; шаблон</span>
<span class="token comment">;    (... n))</span>
<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">double</span> n<span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token operator">*</span> n <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                             <span class="token comment">; тело функции</span>
</code></pre></div><h3 id="_5-тестирование-и-исправnения"><a href="#_5-тестирование-и-исправnения" aria-hidden="true" class="header-anchor">#</a> 5. Тестирование и исправления</h3> <p>Запустить программу. Если тесты не выполняются, найти и исправить ошибки.</p> <h2 id="пример-функции-со-строками"><a href="#пример-функции-со-строками" aria-hidden="true" class="header-anchor">#</a> Пример функции со строками</h2> <p>Задача:</p> <blockquote><p>Design a function that pluralizes a given word. (Pluralize means to convert the word to its plural form.) For simplicity you may assume that just adding s is enough to pluralize a word.</p></blockquote> <p>Написать функцию, которая возвращает множественное число переданного слова (добавление <code>s</code> в конце достаточно).</p> <p>Реализация по рецепту:</p> <div class="language-scheme extra-class"><pre class="language-scheme"><code><span class="token comment">;; String -&gt; String</span>
<span class="token comment">;; Produce the given string with &quot;s&quot; added to the end.</span>
<span class="token punctuation">(</span><span class="token function">check-expect</span> <span class="token punctuation">(</span><span class="token function">pluralize</span> <span class="token string">&quot;hat&quot;</span><span class="token punctuation">)</span> <span class="token string">&quot;hats&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">check-expect</span> <span class="token punctuation">(</span><span class="token function">pluralize</span> <span class="token string">&quot;car&quot;</span><span class="token punctuation">)</span> <span class="token string">&quot;cars&quot;</span><span class="token punctuation">)</span>
 
<span class="token comment">; (define (pluralize w) &quot;&quot;)</span>

<span class="token comment">; (define (pluralize w)</span>
<span class="token comment">;  (... w))</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">pluralize</span> w<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token function">string-append</span> w <span class="token string">&quot;s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>Sometimes a program we design doesn't work properly. The program might get an error or a test might fail. One useful skill in trying to find the problem is to scan over the design elements looking for inconsistencies. Does the purpose match the signature? Do the tests match the signature and purpose? Does the stub match what comes before it? Does the function header match the signature and purpose? Does the function body match the signature, purpose and tests?</p> <p>Often times looking for an inconsistency between different parts of these is enough to find the bug and make it clear what needs to be fixed.</p></blockquote> <h2 id="отnадка"><a href="#отnадка" aria-hidden="true" class="header-anchor">#</a> Отладка</h2> <p>Если тест провалился на уже написанной функции, это значит, что есть ошибка:</p> <ul><li>в самом тесте (вызов функции или ожидаемый результат могут быть некорректны);</li> <li>в определении функции;</li> <li>и определение и тест некорректны.</li></ul> <div class="tip custom-block"><p class="custom-block-title">Хозяйке на заметку</p> <p>Проверить нужно сначала тесты, а потом уже саму функцию, чтобы ненароком её не испортить.</p></div> <h2 id="рецепт-не-по-шагам"><a href="#рецепт-не-по-шагам" aria-hidden="true" class="header-anchor">#</a> Рецепт не по шагам</h2> <p>Рецепт HTdF позволяет некоторые вольности в реализации шагов:</p> <blockquote><p>It's a structured process, but it's not a locked-in waterfall process.</p></blockquote> <p>Мы можем возвращаться назад на шаг или несколько шагов, исправлять ошибки, дополнять или уточнять детали. Например, сигнатуру неправильно написали, дошли до шаблона, заметили ошибку, вернулись и поправили — это норма.</p> <p>Иногда может быть не ясна сигнатура и в этом случае можно начать с примеров, а к сигнатуре вернуться позже. <strong>Только не надо сразу врываться и писать тело функции</strong>, это похерит весь дизайн-процесс.</p> <h3 id="выбор-типа-данных-в-сигнатуре"><a href="#выбор-типа-данных-в-сигнатуре" aria-hidden="true" class="header-anchor">#</a> Выбор типа данных в сигнатуре</h3> <p>В сигнатуре нужно указывать самый специфичный, самый четкий тип, который возможен.</p> <p>Например, нужно посчитать площадь прямоугольника. Длина и ширина в Ракете задаются в пикселях, а они не могут быть десятичные или еще какие-то. Пиксели дискретны и могут быть только целочисленные (натуральные). Поэтому сигнатура будет не <code>Image -&gt; Number</code>, а <code>Image -&gt; Natural</code>:</p> <div class="language-scheme extra-class"><pre class="language-scheme"><code><span class="token punctuation">(</span><span class="token function">require</span> 2htdp/image<span class="token punctuation">)</span>

<span class="token comment">;; Image -&gt; Natural</span>
<span class="token comment">;; Produces image's area (width * height).</span>
<span class="token punctuation">(</span><span class="token function">check-expect</span>
    <span class="token punctuation">(</span><span class="token function">image-area</span> <span class="token punctuation">(</span><span class="token function">rectangle</span> <span class="token number">10</span> <span class="token number">20</span> <span class="token string">&quot;solid&quot;</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token operator">*</span> <span class="token number">10</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">check-expect</span>
    <span class="token punctuation">(</span><span class="token function">image-area</span> <span class="token punctuation">(</span><span class="token function">rectangle</span> <span class="token number">22.2</span> <span class="token number">33</span> <span class="token string">&quot;solid&quot;</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token operator">*</span> <span class="token number">22</span> <span class="token number">33</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">; pixels are always integers:</span>

<span class="token comment">; (define (image-area img) 0)</span>
<span class="token comment">; (define (image-area img)</span>
<span class="token comment">;     (... img))</span>
<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">image-area</span> img<span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token function">image-height</span> img<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token function">image-width</span> img<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>В примере выше вполне возможно по привычке сначала указать <code>Number</code>, а в процессе понять, что нужен <code>Natural</code>.</p> <p>Четкий тип данных способствует лучшему пониманию и помогает при отладке.</p> <h2 id="poorly-formed-problems"><a href="#poorly-formed-problems" aria-hidden="true" class="header-anchor">#</a> Poorly Formed Problems</h2> <p>В реальной жизни задачи редко бывают четкими. Часть процесса проектирования — сделать задачу структурированной и хорошо в ней разобраться:</p> <blockquote><p>Design is the process of going from a poorly formed problem to a well structured solution. So making the problem more specific is part of the design process.</p></blockquote> <p>Пример такой задачи: определите, является ли картинка высокой. Что значит высокой? У высокой картинки высота больше ширины. Значит более конкретно задачу можно сформулировать так: напишите функцию, которая вернет <code>true</code>, если высота картинки больше её ширины.</p> <p>Сигнатура и назначение для этой функции:</p> <div class="language-scheme extra-class"><pre class="language-scheme"><code><span class="token punctuation">(</span><span class="token function">require</span> 2htdp/image<span class="token punctuation">)</span>

<span class="token comment">;; Image -&gt; Boolean                  ; сигнатура</span>
<span class="token comment">;; produce true if image is tall     ; назначение</span>
</code></pre></div><p>Строка назначения в функции, которая возвращает <code>true</code> или <code>false</code> должна объяснять, как интерпретировать этот ответ. В данном случае <code>true</code> означает, что картинка высокая.</p> <p>Функции-предикаты в Racket принято заканчивать вопросительным знаком: <code>tall?</code>. В других языках или командах могут быть свои соглашения. Например, часто такие функции начинаться с префикса <code>is</code>: <code>isTall()</code>.</p> <p>В теле функции нам нужно сравнить высоту и ширину картинки и вернуть <code>true</code>, если высота больше или <code>false</code>, если нет. Можно использовать <code>if</code>:</p> <div class="language-scheme extra-class"><pre class="language-scheme"><code><span class="token comment">;; Image -&gt; Boolean                                           ; сигнатура</span>
<span class="token comment">;; produce true if image is tall                              ; назначение</span>
<span class="token punctuation">(</span><span class="token function">check-expect</span> <span class="token punctuation">(</span><span class="token function">tall?</span> <span class="token punctuation">(</span><span class="token function">rectangle</span> <span class="token number">20</span> <span class="token number">40</span> <span class="token string">&quot;solid&quot;</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> true<span class="token punctuation">)</span>   <span class="token comment">; пример-тест</span>

<span class="token comment">;(define (tall? img) false)                                   ; заглушка</span>
<span class="token comment">;(define (tall? img)                                          ; шаблон</span>
<span class="token comment">;  (... img))</span>
<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">tall?</span> img<span class="token punctuation">)</span>                                           <span class="token comment">; функция</span>
  <span class="token punctuation">(</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token function">image-height</span> img<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token function">image-width</span> img<span class="token punctuation">)</span><span class="token punctuation">)</span>
      true
      false<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>Запустив такую функцию мы увидим, что DrRacket подсветил <code>false</code>:</p> <p><img src="/mooc_htdp/assets/img/not_enough_tests.b2e2c624.png" alt></p> <p>Это значит, что при запуске тестов <code>false</code> никогда не был возвращен.</p> <div class="tip custom-block"><p class="custom-block-title">Объяснялочка</p> <p>DrRacket автоматически проверяет покрытие кода тестами. Если в <code>if</code> подсвечивается какое-то возвращаемое значение, значит для этого случая не написан тест (при запуске тестов это значение ни разу не возвращалось).</p> <p>— <strong>Так сколько нужно тестов для функции?</strong><br>
— Тестов для функции должно быть столько, сколько нужно для отработки всех вариантов её выполнения.</p> <p>Например, для функции <code>tall?</code> нужно проверить 3 варианта:</p> <ol><li>Высота больше ширины (<code>true</code>, картинка высокая).</li> <li>Высота меньше ширины (<code>false</code>, картинки невысокая).</li> <li>Ширина равна высоте, граничный случай (тоже <code>false</code>, картинки невысокая).</li></ol> <p>Граничный случай, он же boundary value, он же corner case. Граничные случаи также нужно учитывать в тестах.</p></div> <p>Добавим нужные тесты в функцию.</p> <p>Учтём граничное значение и обновим строку назначения: уточним, что картинка считается высокой только когда высота больше ширины.</p> <p>А ещё код можно упростить. Условие внутри <code>if</code> со знаком <a href="https://docs.racket-lang.org/htdp-langs/beginner.html#%28def._htdp-beginner._%28%28lib._lang%2Fhtdp-beginner..rkt%29._~3e%29%29" target="_blank" rel="noopener noreferrer"><code>&gt;</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> само по себе возвращает булево значение, поэтому вместо <code>if</code> можно оставить только его:</p> <div class="language-scheme extra-class"><pre class="language-scheme"><code><span class="token punctuation">(</span><span class="token function">require</span> 2htdp/image<span class="token punctuation">)</span>

<span class="token comment">;; Image -&gt; Boolean</span>
<span class="token comment">;; produce true if image is tall (height is greater than width)</span>
<span class="token punctuation">(</span><span class="token function">check-expect</span> <span class="token punctuation">(</span><span class="token function">tall?</span> <span class="token punctuation">(</span><span class="token function">rectangle</span> <span class="token number">20</span> <span class="token number">40</span> <span class="token string">&quot;solid&quot;</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> true<span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">check-expect</span> <span class="token punctuation">(</span><span class="token function">tall?</span> <span class="token punctuation">(</span><span class="token function">rectangle</span> <span class="token number">60</span> <span class="token number">40</span> <span class="token string">&quot;solid&quot;</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> false<span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">check-expect</span> <span class="token punctuation">(</span><span class="token function">tall?</span> <span class="token punctuation">(</span><span class="token function">rectangle</span> <span class="token number">20</span> <span class="token number">20</span> <span class="token string">&quot;solid&quot;</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> false<span class="token punctuation">)</span>

<span class="token comment">;(define (tall? img) false)</span>
<span class="token comment">;(define (tall? img)</span>
<span class="token comment">;  (... img))</span>
<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">tall?</span> img<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token function">image-height</span> img<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token function">image-width</span> img<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">; true, если больше,</span>
                                            <span class="token comment">; false в остальных случаях.</span>
                                            <span class="token comment">; if не нужен.</span>
</code></pre></div><h2 id="граничные-сnучаи"><a href="#граничные-сnучаи" aria-hidden="true" class="header-anchor">#</a> Граничные случаи</h2> <p>Часто граничные случаи вылезают в процессе работы над функцией. Как только такой случай вылез, нужно:</p> <ul><li>Написать пример-тест для него;</li> <li>Обновить уже записанные по рецепту шаги (назначение, иногда сигнатуру, может даже другие тесты);</li> <li>Исправить или дополнить тело функции.</li></ul> <h2 id="проверка-заданий-на-edx"><a href="#проверка-заданий-на-edx" aria-hidden="true" class="header-anchor">#</a> Проверка заданий на edX</h2> <p>Оценки: Poor, Fair, Great.</p> <p>Commit ready:</p> <ul><li>все хорошо отформатировано</li> <li>нет лишних ненужных комментариев</li> <li>нет лишнего вспомогательного кода (экспериментов в процессе решения)</li></ul> <p>Design Completeness: представлены все шаги HTDF-рецепта и все они валидны (тесты запускаются, нормально сформулированы сигнатура и назначение, есть заглушка и шаблон).</p> <p>Internal Quality:</p> <ul><li>HTDF составляющие должны быть корректны и понятны и соответствовать рецепту;</li> <li>Хорошо подобрано имя функции;</li> <li>Тесты должны проходить и покрытие кода должно быть полное.</li></ul> <p>Problem Satisfied:</p> <ul><li>функция должна решать поставленную задачу;</li> <li>неопределенности в постановке задачи должны быть преодолены в процессе выполнения HTDF.</li></ul></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/mooc_htdp/1a_bsl/" class="prev">
          1a: Beginning Student Language
        </a></span> <span class="next"><a href="/mooc_htdp/2_htdd/">
          2: How to Design Data
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/mooc_htdp/assets/js/app.592f2e84.js" defer></script><script src="/mooc_htdp/assets/js/5.04b7ebe3.js" defer></script>
  </body>
</html>
